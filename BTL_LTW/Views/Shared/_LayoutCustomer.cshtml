<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>@ViewBag.Title</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
          rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="~/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="~/css/auth.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="~/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="~/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/style.css" type="text/css">
</head>
<body>
    <div>
        @* Header *@

        @await Html.PartialAsync("_PagePreloder")

        @await Html.PartialAsync("_OffCanvasMenu")

        @await Html.PartialAsync("_Header")

        @RenderBody()

        @* Footer *@
        @await Html.PartialAsync("_Footer")
    </div>

    <!-- Js Plugins -->
    <script src="~/js/jquery-3.3.1.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
    <script src="~/js/jquery.nice-select.min.js"></script>
    <script src="~/js/jquery.nicescroll.min.js"></script>
    <script src="~/js/jquery.magnific-popup.min.js"></script>
    <script src="~/js/jquery.countdown.min.js"></script>
    <script src="~/js/jquery.slicknav.js"></script>
    <script src="~/js/mixitup.min.js"></script>
    <script src="~/js/owl.carousel.min.js"></script>
    <script src="~/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    @RenderSection("Styles", required: false)
    @await RenderSectionAsync("Scripts", required: false)
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Hàm gọi tới Controller để lấy tổng tiền & tổng số sản phẩm
            function loadCartTotal() {
                $.get('/ShoppingCart/GetCartTotal', function (res) {
                    if (res) {
                        // Hiển thị tổng tiền (2 số thập phân)
                        $("#cartPrice").text(`$${res.total.toFixed(2)}`);
                        // Hiển thị số lượng sản phẩm
                        $("#cartCount").text(res.count);
                    }
                });
            }

            // Gọi khi trang load
            loadCartTotal();

            // Cho phép các trang khác gọi lại (ví dụ: AddToCart)
            window.refreshCartTotal = loadCartTotal;
        });
    </script>
    <script>
        $(document).on('click', '.js-add-cart', function (e) {
            e.preventDefault();
            var id = $(this).data('id');

            $.post('/ShoppingCart/AddToCart', { id: id }, function (res) {
                if (res.needLogin) {
                    window.location = '/KhachHang/DangNhap';
                    return;
                }
                if (res.ok) {
                    // Cập nhật header
                    if (typeof res.count !== 'undefined') {
                        $('#cartCount').text(res.count);
                    }
                    if (typeof res.total !== 'undefined') {
                        // format tiền đơn giản
                        const formatted = '$' + Number(res.total).toFixed(2);
                        $('#cartPrice').text(formatted);
                    }
                    // Thông báo thành công (toast đơn giản)
                    showToast('Đã thêm sản phẩm vào giỏ hàng!');
                } else {
                    showToast(res.message || 'Không thể thêm sản phẩm.', true);
                }
            });
        });

        // Toast đơn giản (không cần thư viện ngoài)
        function showToast(msg, isError) {
            let toast = $('#appToast');
            if (!toast.length) {
                $('body').append(`
                  <div id="appToast"
                       style="position:fixed;right:20px;top:20px;z-index:9999;
                              padding:12px 16px;border-radius:8px;color:#fff;
                              box-shadow:0 6px 20px rgba(0,0,0,.15);display:none;">
                  </div>`);
                toast = $('#appToast');
            }
            toast.css('background', isError ? '#dc3545' : '#28a745')
                 .text(msg)
                 .fadeIn(150, function () {
                     setTimeout(() => toast.fadeOut(300), 1400);
                 });
        }
    </script>



</body>
</html>
